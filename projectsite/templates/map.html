{% extends 'base.html' %}
{% block content %}
<div class="page-inner">
    <h4 class="page-title">Fire Incidents Map</h4>
    <div class="form-group">
        <label for="cityFilter">Filter by City:</label>
        <input type="text" id="cityFilter" class="form-control" placeholder="Enter city name">
        <button id="filterButton" class="btn btn-primary mt-2">Filter</button>
    </div>
    <div id="map" style="height: 500px;"></div>
</div>
<script>
    let map;
    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 37.7749, lng: -122.4194 }, // Default center
            zoom: 8,
        });
        loadIncidents();
    }

    function loadIncidents(city = "") {
        const url = city ? `/fireIncidents/?city=${city}` : "/fireIncidents/";
        fetch(url)
            .then((response) => response.json())
            .then((data) => {
                data.forEach((incident) => {
                    new google.maps.Marker({
                        position: { lat: incident.latitude, lng: incident.longitude },
                        map: map,
                        title: `City: ${incident.city}, Severity: ${incident.severity}`,
                    });
                });
            });
    }

    document.getElementById("filterButton").addEventListener("click", () => {
        const city = document.getElementById("cityFilter").value;
        loadIncidents(city);
    });
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap" async defer></script>
{% endblock %}